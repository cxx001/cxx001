<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Hexo">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.0.0">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://cxx001.gitee.io">
    <!--SEO-->

<meta name="keywords" content="nodejs,服务器架构,仿真" />


<meta name="description" content="

Table of Contents  generated with DocToc

一 服务端架构概览
技术选型
整体架构


二 通信协议格式
1. 与前端通信
Package层
Mess..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    飞行仿真项目服务端设计 |
    
    Hexo
</title>

<link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">

    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<meta name="generator" content="Hexo 6.2.0"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    https://hexo-theme-snippet-1251680922.cos.ap-beijing.myqcloud.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='John Doe'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="https://cxx001.gitee.io">
                        Hexo</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="飞行仿真项目服务端设计">
            
            飞行仿真项目服务端设计
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/project/">project</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-none-link" href="/tags/nodejs/" rel="tag">nodejs</a> <a class="tag-none-link" href="/tags/%E4%BB%BF%E7%9C%9F/" rel="tag">仿真</a> <a class="tag-none-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E6%9E%84/" rel="tag">服务器架构</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2022/08/01</span>
    </span>
    
    <span class="fa-wrap">
        <i class="fa fa-eye"></i>
        <span id="busuanzi_value_page_pv"></span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong>  <em>generated with <a target="_blank" rel="noopener" href="https://github.com/thlorenz/doctoc">DocToc</a></em></p>
<ul>
<li><a href="#%E4%B8%80-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88">一 服务端架构概览</a><ul>
<li><a href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B">技术选型</a></li>
<li><a href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84">整体架构</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F">二 通信协议格式</a><ul>
<li><a href="#1-%E4%B8%8E%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1">1. 与前端通信</a><ul>
<li><a href="#package%E5%B1%82">Package层</a></li>
<li><a href="#message%E5%B1%82">Message层</a></li>
</ul>
</li>
<li><a href="#2-%E4%B8%8E%E5%BC%95%E6%93%8E%E9%80%9A%E4%BF%A1">2. 与引擎通信</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E7%94%A8%E6%88%B7gra4%E5%B7%A5%E7%A8%8B%E5%AF%BC%E5%85%A5">三 用户Gra4工程导入</a><ul>
<li><a href="#gra4%E6%A0%BC%E5%BC%8F">Gra4格式</a></li>
<li><a href="#db%E6%A0%BC%E5%BC%8F">DB格式</a></li>
<li><a href="#%E4%B8%8B%E4%BD%8D%E6%9C%BA%E5%BC%95%E6%93%8E%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E5%B9%B3%E9%93%BA%E5%90%8E%E7%9A%84%E6%A0%BC%E5%BC%8F">下位机引擎生成代码平铺后的格式</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->

<h1 id="一-服务端架构概览"><a href="#一-服务端架构概览" class="headerlink" title="一 服务端架构概览"></a>一 服务端架构概览</h1><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><blockquote>
<p>nodejs + mongodb，多进程、分布式的服务器。</p>
</blockquote>
<p>nodejs优势:</p>
<ul>
<li>io与可伸缩性的优势。io密集型的应用采用node.js是最合适的， 可达到最好的可伸缩性。</li>
<li>多进程单线程的应用架构。node.js天生采用单线程， 使它在处理复杂逻辑的时候无需考虑线程同步、锁、死锁等一系列问题， 减少了很多逻辑错误。 由多进程node.js组成的服务器群是最理想的应用架构之一。</li>
<li>语言优势。使用javascript开发可以实现快速迭代，如果客户端使用html 5，更可实现代码共用。</li>
</ul>
<p>mongodb优势:</p>
<ul>
<li>使用简单、方便。不需要预先定义表结构, 和写json配置一样自然。</li>
</ul>
<h2 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h2><p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/project.jpg"></p>
<p>注： 上图中的方块表示进程， 定义上等同于“服务器“</p>
<blockquote>
<p>运行架构说明：</p>
</blockquote>
<ul>
<li>客户端登录网关服(gate), 网关服会根据connector服务器群负载情况，动态分配一个返回给客户端。</li>
<li>客户端通过websocket长连接连到connector服务器群。</li>
<li>connector负责承载连接，并把请求转发到后端的服务器群。</li>
<li>后端的服务器群主要包括引擎服务器(engine)、验证服务器(auth)等， 这些服务器负责各自的业务逻辑。后面还会有各种其它类型的服务器。</li>
<li>后端服务器处理完逻辑后把结果返回给connector， 再由connector广播回给客户端。</li>
<li>master负责统一管理这些服务器，包括各服务器的启动、监控和关闭等功能。</li>
</ul>
<h1 id="二-通信协议格式"><a href="#二-通信协议格式" class="headerlink" title="二 通信协议格式"></a>二 通信协议格式</h1><h2 id="1-与前端通信"><a href="#1-与前端通信" class="headerlink" title="1. 与前端通信"></a>1. 与前端通信</h2><blockquote>
<p>基于tcp&#x2F;websocket方式通信, 底层使用的是二进制协议。协议包含两层编码: package和message。message层主要实现route压缩和protobuf压缩，message层的编码结果将传递给package层。package层主要实现应用基于二进制协议的握手过程，心跳和数据传输编码，package层的编码结果可以通过tcp，websocket等协议以二进制数据的形式进行传输。message层编码可选，也可替换成其他二进制编码格式，都不影响package层编码和发送。</p>
</blockquote>
<p>协议层的结构如下图所示：</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/protol.jpg"></p>
<h3 id="Package层"><a href="#Package层" class="headerlink" title="Package层"></a>Package层</h3><blockquote>
<p>package格式</p>
</blockquote>
<p>package分为header和body两部分。header描述package包的类型和包的长度，body则是需要传输的数据内容。具体格式如下：</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/package.jpg"></p>
<ul>
<li><p>type - package类型，1个byte，取值如下。</p>
<ul>
<li>0x01: 客户端到服务器的握手请求以及服务器到客户端的握手响应</li>
<li>0x02: 客户端到服务器的握手ack</li>
<li>0x03: 心跳包</li>
<li>0x04: 数据包</li>
<li>0x05: 服务器主动断开连接通知</li>
</ul>
</li>
<li><p>length - body内容长度，3个byte的大端整数，因此最大的包长度为2^24个byte。</p>
</li>
<li><p>body - 二进制的传输内容。</p>
</li>
</ul>
<blockquote>
<p>握手</p>
</blockquote>
<p>握手流程主要提供一个机会，让客户端和服务器在连接建立后，进行一些初始化的数据交换。<br>握手的内容为utf-8编码的json字符串（不压缩），通过body字段传输。</p>
<p>握手请求：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;sys&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.1.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;js-websocket&quot;</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;user&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// any customized request data</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>握手响应:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,             <span class="comment">// response code</span></span><br><span class="line">  <span class="string">&quot;sys&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;heartbeat&quot;</span>: <span class="number">3</span>,     <span class="comment">// heartbeat interval in second</span></span><br><span class="line">    <span class="string">&quot;dict&quot;</span>: &#123;&#125;,         <span class="comment">// route dictionary</span></span><br><span class="line">    <span class="string">&quot;protos&quot;</span>: &#123;&#125;        <span class="comment">// protobuf definition data</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;user&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// any customized response data</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>握手流程如下:</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/handshake.jpg"></p>
<p>当底层连接建立后，客户端向服务器发起握手请求，并附带必要的数据。服务器检验握手数据后，返回握手响应。如果握手成功，客户端向服务器发送一个握手ack，握手阶段至此成功结束。</p>
<blockquote>
<p>心跳</p>
</blockquote>
<p>心跳包的length字段为0，body为空。</p>
<p>心跳的流程如下：</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/heatbeat.jpg"></p>
<p>服务器可以配置心跳时间间隔。当握手结束后，客户端发起第一个心跳。服务器和客户端收到心跳包后，延迟心跳间隔的时间后再向对方发送一个心跳包。</p>
<p>心跳超时时间为2倍的心跳间隔时间。服务器检测到心跳超时并不会主动断开客户端的连接。客户端检测到心跳超时，可以根据策略选择是否要主动断开连接。</p>
<blockquote>
<p>数据</p>
</blockquote>
<p>数据包用来在客户端和服务器之间传输数据所用。数据包的body是由上层传下来的任意二进制数据，package层不会对body内容做任何处理。</p>
<blockquote>
<p>服务器主动断开</p>
</blockquote>
<p>当服务器主动断开客户端连接时（如：踢掉某个在线用户），会先向客户端发送一个控制消息，然后再断开连接。客户端可以通过这个消息来判断是否是服务器主动断开连接的。</p>
<h3 id="Message层"><a href="#Message层" class="headerlink" title="Message层"></a>Message层</h3><p>message协议的主要作用是封装消息头，包括route和消息类型两部分，不同的消息类型有着不同的消息头，在消息头里面可能要打入message id(即requestId)和route信息。由于可能会有route压缩，而且对于服务端push的消息，message id为空，对于客户端请求的响应，route为空，因此message的头格式比较复杂。</p>
<p>消息头分为三部分，flag，message id，route。如下图所示：</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/message-head.jpg"></p>
<p>从上图可以看出，消息头是可变的，会根据具体的消息类型和内容而改变。其中：</p>
<ul>
<li>flag位是必须的，占用一个byte，它决定了后面的消息类型和内容的格式;</li>
<li>message id和route则是可选的。其中message id采用<strong>varints 128变长编码</strong>方式，根据值的大小，长度在0～5byte之间。route则根据消息类型以及内容的大小，长度在0～255byte之间。</li>
</ul>
<blockquote>
<p>标志位flag</p>
</blockquote>
<p>flag占用message头的第一个byte，其内容如下:</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/mesage-flag.jpg"></p>
<p>现在只用到了其中的4个bit，这四个bit包括两部分，占用3个bit的message type字段和占用1个bit的route标识，其中：</p>
<ul>
<li>message type用来标识消息类型,范围为0～7，现在消息共有四类，request，notify，response，push，值的范围是0～3。不同的消息类型有着不同的消息内容，下面会有详细分析。</li>
<li>最后一位的route表示route是否压缩，影响route字段的长度。 这两部分之间相互独立，互不影响。</li>
</ul>
<blockquote>
<p>消息类型</p>
</blockquote>
<p>不同类型的消息，对应不同消息头，消息类型通过flag字段的第2-4位来确定，其对应关系以及相应的消息头如下图：</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/message-type.jpg"></p>
<blockquote>
<p>route压缩标志位</p>
</blockquote>
<p>route主要分为压缩和未压缩两种，由flag的最后一位（route压缩标志位）指定，当flag中的route标志为0时，表示未压缩的route，为1则表示是压缩route。route字段的编码会依赖flag的这一位，其格式如下图:</p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/message-route.jpg"></p>
<p>上图是不同的flag标志对应的route字段的内容：</p>
<ul>
<li>flag的最后一位为1时，后面跟的是一个uInt16表示的route字典编号，需要通过查询字典来获取route;</li>
<li>flag最后一位为0是，后面route则由一个uInt8的byte，用来表示route的字节长度。之后是通过utf8编码后的route字符串，其长度就是前面一位byte的uInt8的值，因此route的长度最大支持256B。</li>
</ul>
<h2 id="2-与引擎通信"><a href="#2-与引擎通信" class="headerlink" title="2. 与引擎通信"></a>2. 与引擎通信</h2><p>采用zmq通信，在后台服务器engine上起两个监听端口, 分别是zmq的Publisher模式(25150)和Pull模式(25151)。</p>
<blockquote>
<p>服务端向下位机引擎发送消息:</p>
</blockquote>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/engine-send.jpg"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Publisher模式:</span></span><br><span class="line"><span class="comment">// 下位机引擎建立连接时，注册以uid为key的管道</span></span><br><span class="line">sock.<span class="title function_">connect</span>(<span class="string">&quot;tcp://127.0.0.1:25150&quot;</span>)</span><br><span class="line">sock.<span class="title function_">subscribe</span>(<span class="string">&quot;uid&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端向下位机引擎发送消息</span></span><br><span class="line">sock.<span class="title function_">send</span>([<span class="string">&quot;uid&quot;</span>, <span class="string">&quot;message&quot;</span>])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下位机引擎向服务端发送消息：</p>
</blockquote>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/engine-rsv.jpg"></p>
<h1 id="三-用户Gra4工程导入"><a href="#三-用户Gra4工程导入" class="headerlink" title="三 用户Gra4工程导入"></a>三 用户Gra4工程导入</h1><h2 id="Gra4格式"><a href="#Gra4格式" class="headerlink" title="Gra4格式"></a>Gra4格式</h2><p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/gra4.jpg"></p>
<p>主要的几个字段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">UnitGroup</span>: 当前画板模型列表</span><br><span class="line"><span class="title class_">IoportGroup</span>: 输入/输出模块列表</span><br><span class="line"><span class="title class_">LineGroup</span>: 连线列表</span><br></pre></td></tr></table></figure>

<h2 id="DB格式"><a href="#DB格式" class="headerlink" title="DB格式"></a>DB格式</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工程表 project</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    id<span class="punctuation">:</span> String    <span class="comment">// 项目ID</span></span><br><span class="line">    uid<span class="punctuation">:</span> String   <span class="comment">// 用户ID</span></span><br><span class="line">    data<span class="punctuation">:</span> <span class="punctuation">[</span>sub<span class="punctuation">]</span>   <span class="comment">// 画板数组，每个元素对应一个画板</span></span><br><span class="line"><span class="punctuation">&#125;</span>      </span><br><span class="line"></span><br><span class="line">sub<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    id<span class="punctuation">:</span> String      <span class="comment">// 画板ID</span></span><br><span class="line">    name<span class="punctuation">:</span> String    <span class="comment">// 画板名称</span></span><br><span class="line">    pid<span class="punctuation">:</span> String     <span class="comment">// 画板关联的父ID</span></span><br><span class="line">    block<span class="punctuation">:</span> <span class="punctuation">[</span>block<span class="punctuation">]</span>  <span class="comment">// 画板包含的模型</span></span><br><span class="line">    line<span class="punctuation">:</span> <span class="punctuation">[</span>line<span class="punctuation">]</span>    <span class="comment">// 画板包含的线</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">block<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    id<span class="punctuation">:</span> String        <span class="comment">// 模型ID</span></span><br><span class="line">    child<span class="punctuation">:</span> String     <span class="comment">// 模型关联的子画板ID(即子系统)</span></span><br><span class="line">    modelId<span class="punctuation">:</span> String   <span class="comment">// 关联导入的数字模型ID (uid_dll_funcName)</span></span><br><span class="line">    name<span class="punctuation">:</span> String      <span class="comment">// 模型名称</span></span><br><span class="line">    nodeType<span class="punctuation">:</span> Number  <span class="comment">// 模型类型(方形、圆形)</span></span><br><span class="line">    position<span class="punctuation">:</span> Object  <span class="comment">// 模型位置  &#123; &quot;x&quot;: number, &quot;y&quot;: number &#125;</span></span><br><span class="line">    size<span class="punctuation">:</span> Object      <span class="comment">// 模型大小  &#123; &quot;width&quot;: number), &quot;height&quot;: number &#125;;</span></span><br><span class="line">    items<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;out_0&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;in&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;in_0&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;out&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span>  <span class="comment">// 端口描述</span></span><br><span class="line">    entity<span class="punctuation">:</span> String    <span class="comment">// 切换的实物ID, 默认null</span></span><br><span class="line">    modifyAttr<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>    <span class="comment">// 修改的属性(和simulink逻辑一致, 先这里取修改的, 没有再去导入数字模型表中取)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">line<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    id<span class="punctuation">:</span> String        <span class="comment">// 连线ID</span></span><br><span class="line">    lineType<span class="punctuation">:</span> Number  <span class="comment">// 连线类型 1: 细线  2: 粗线</span></span><br><span class="line">    source<span class="punctuation">:</span> Object    <span class="comment">// 线头   &#123;&quot;cell&quot;: 模型ID, &quot;port&quot;: 端口ID&#125;</span></span><br><span class="line">    target<span class="punctuation">:</span> Object    <span class="comment">// 线尾   &#123;&quot;cell&quot;: 模型ID, &quot;port&quot;: 端口ID&#125;</span></span><br><span class="line">    subLine<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span>       <span class="comment">// 粗线详情 [&#123;source: Object, target: Object&#125;]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例结构</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    id<span class="punctuation">:</span> string</span><br><span class="line">    uid<span class="punctuation">:</span> string</span><br><span class="line">    data<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            id<span class="punctuation">:</span> string<span class="punctuation">,</span></span><br><span class="line">            pid<span class="punctuation">:</span> string<span class="punctuation">,</span></span><br><span class="line">            name<span class="punctuation">:</span> string<span class="punctuation">,</span></span><br><span class="line">            block<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">                id<span class="punctuation">:</span> string<span class="punctuation">,</span></span><br><span class="line">                child<span class="punctuation">:</span> string<span class="punctuation">,</span></span><br><span class="line">                modelId<span class="punctuation">:</span> string<span class="punctuation">,</span></span><br><span class="line">                name<span class="punctuation">:</span> string<span class="punctuation">,</span>    </span><br><span class="line">                nodeType<span class="punctuation">:</span> int<span class="punctuation">,</span></span><br><span class="line">                position<span class="punctuation">:</span> Object<span class="punctuation">,</span></span><br><span class="line">                size<span class="punctuation">:</span> Object<span class="punctuation">,</span></span><br><span class="line">                items<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;out_0&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;in&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;in_0&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;out&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                entity<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                modifyAttr<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span> </span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            line<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">                id<span class="punctuation">:</span> string<span class="punctuation">,</span></span><br><span class="line">                lineType<span class="punctuation">:</span> int<span class="punctuation">,</span></span><br><span class="line">                source<span class="punctuation">:</span> Object<span class="punctuation">,</span></span><br><span class="line">                target<span class="punctuation">:</span> Object<span class="punctuation">,</span></span><br><span class="line">                subLine<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>一个项目就是一个树结构，根节点就是顶层画板，子节点是子系统画板，叶子节点是最小的模型。</p>
<blockquote>
<p>Gra4转DB整体思路：</p>
</blockquote>
<ol>
<li>读取解析项目中所有gra4文件，并找出顶层画板gra4对象(根据IoportGroup的Count属性为0判断)。</li>
<li>从顶层画板开始递归遍历。</li>
<li>首先确定当前遍历画板的中间模块和连线关系(不考虑Ioport相关模块与连线), 即下图圈起来部分:</li>
</ol>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/demo2.jpg"></p>
<ol start="4">
<li>然后确定当前遍历画板的IO模块和连线关系：</li>
</ol>
<ul>
<li><p>遍历与Ioport模块相关连的线，并记录连线端口信息。</p>
</li>
<li><p>然后在当前画板的父画板所有连线中找到与当前子系统连线端口一致的连线。</p>
</li>
<li><p>如果外边连线是粗线(一组线)，则需要判断是否展开，如果线连接的是子系统与子系统则不需要展开, 其它都展开。</p>
</li>
<li><p>如果是展开，则每条展开的线对应一个IO模块，以这条线对应的端口做为其ID。然后把连线关系建立起来。</p>
</li>
<li><p>如果不展开，则这条线会对应创建一个IO模块，如果这条线详情大于1条，则还会创建一个总线模块，IO模块ID同样根据线对应的端口确定，总线端口则根据线详情确定。最后把连线关系建立起来。</p>
<p> 转换后的示意图:</p>
</li>
</ul>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/panel1.jpg"></p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/panel2.jpg"></p>
<p><img src="https://cxx001.gitee.io/2022/08/01/project/%E9%A3%9E%E8%A1%8C%E4%BB%BF%E7%9C%9F%E9%A1%B9%E7%9B%AE%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%BE%E8%AE%A1/panel3.jpg"></p>
<h2 id="下位机引擎生成代码平铺后的格式"><a href="#下位机引擎生成代码平铺后的格式" class="headerlink" title="下位机引擎生成代码平铺后的格式"></a>下位机引擎生成代码平铺后的格式</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;PartitionGroup&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;CpuId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;动力仿真子模型&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;BlockGroup&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;发动机1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Model&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Engine/EngineClass.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Order&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;BlcokCount&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;CpuId&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;弹道&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;BlockGroup&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;部段1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Model&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Mass/SegmentFunction.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;Order&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;BlcokCount&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;LineGroup&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Src&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Dst&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SrcPort&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;DstPort&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SrcName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;发动机1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;DstName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;贮箱1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;IP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192.168.0.100&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;PartitionTotal&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;BlockTotal&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;LineTotal&quot;</span><span class="punctuation">:</span> <span class="number">12</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>DB转换engine平铺格式整体思路：</p>
</blockquote>
<p>难点是生成LineGroup连线，其它信息获取比较简单，遍历DB树就能获取。下面主要记录下LineGroup连线生成的思路：</p>
<ol>
<li>遍历所有最小模块，找出每个最小模块所有输出的连线。</li>
<li>然后遍历每条输出连线，递归查找出每条连线最后连的最小模块，即得到一条平铺后的连线。</li>
<li>递归逻辑：</li>
</ol>
<ul>
<li>如果线连的目标是子系统，则进入到子系统里边，依次找到连的目标递归。</li>
<li>如果线连的目标是IO&#x2F;总线模块，则找到线目标模块递归。</li>
<li>直到线连的目标是最小模块，跳出递归，确定连线。</li>
</ul>

    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">cxx</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2022/08/01/project/QuikPlatform%20Demo%E8%AF%B4%E6%98%8E/" class="pre-post btn btn-default" title='QuikPlatform Demo说明'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            QuikPlatform Demo说明</span>
    </a>
    
    
    <a href="/2022/08/01/pomelo/pomelo%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97/" class="next-post btn btn-default" title='pomelo更新日志'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            pomelo更新日志</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    
    
<div class="utteranc">
  
  <script
    src='https://utteranc.es/client.js'
    repo='cxx001/myblog-comment'
    issue-term='pathname'
    issue-number=''
    theme='github-light'
    label=''
    crossorigin='anonymous'
    async
  ></script>
</div>



</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88"><span class="toc-text">一 服务端架构概览</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-text">技术选型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-text">整体架构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F"><span class="toc-text">二 通信协议格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%B8%8E%E5%89%8D%E7%AB%AF%E9%80%9A%E4%BF%A1"><span class="toc-text">1. 与前端通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Package%E5%B1%82"><span class="toc-text">Package层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Message%E5%B1%82"><span class="toc-text">Message层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%8E%E5%BC%95%E6%93%8E%E9%80%9A%E4%BF%A1"><span class="toc-text">2. 与引擎通信</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E7%94%A8%E6%88%B7Gra4%E5%B7%A5%E7%A8%8B%E5%AF%BC%E5%85%A5"><span class="toc-text">三 用户Gra4工程导入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Gra4%E6%A0%BC%E5%BC%8F"><span class="toc-text">Gra4格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DB%E6%A0%BC%E5%BC%8F"><span class="toc-text">DB格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%BD%8D%E6%9C%BA%E5%BC%95%E6%93%8E%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E5%B9%B3%E9%93%BA%E5%90%8E%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-text">下位机引擎生成代码平铺后的格式</span></a></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
    访问量:
    <strong id="busuanzi_value_site_pv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    &nbsp; | &nbsp;
    访客数:
    <strong id="busuanzi_value_site_uv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2022
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/app.js?rev=@@hash.js"></script>

</body>
</html>